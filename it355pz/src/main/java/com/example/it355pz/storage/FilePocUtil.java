
package com.example.it355pz.storage;

import java.io.IOException;
import java.io.InputStream;
import java.nio.file.Files;
import java.nio.file.Path;
import java.nio.file.Paths;
import java.nio.file.StandardCopyOption;
import org.apache.commons.lang3.RandomStringUtils;
import org.springframework.web.multipart.MultipartFile;


public class FilePocUtil {
    
    private final String UPLOAD_DIR = "./src/main/resources/static/upload/pocs"; 
    
    public String saveFile(String fn, MultipartFile mf) throws IOException{
        
        //StorageProp sp = new StorageProp();
        System.out.println("Unutar metode saveFile Poc");
        
        Path upPath = Paths.get(UPLOAD_DIR);
        //Path upPath = Paths.get("./exploits");
        System.out.println("Path: " + upPath);
        
        if(!Files.exists(upPath)){
            Files.createDirectories(upPath);
        }
        
        String fileRand = RandomStringUtils.randomAlphanumeric(8);
        System.out.println("Random: " + fileRand);
        
        try(InputStream inputStream = mf.getInputStream()){
            Path filePath = upPath.resolve(fileRand + "-" + fn);
            Files.copy(inputStream, filePath, StandardCopyOption.REPLACE_EXISTING);
        }catch(IOException e){
            throw new IOException("Greska oko cuvanja datoteke!", e);
        }
        
        return fileRand;
    }
    
}
